# 第五課	自動車庫門


## 任務背景

智能家居，顧名思義就是家用設備要智能化，自動化的，那出行又怎能不便利化呢？這節課我們就來製作一個能自動感應的車庫門，讓你啟動車就能出門，車到門口就能直接進庫，不必再花費時間來開關車庫的門。


## 器材準備

Arduino 主板、擴展板、電池盒、S90 舵機、紅外避障傳感器、連接線、數據線。

## 一、了解自動車庫門

自動車庫門控制方式主要有無線遙控、感應、手動開關控制等方式。自動車庫門現在主要分類為：卷簾車庫門和翻板車庫門。
本節課做的車庫自動門是利用舵機和紅外避障傳感器實現的，其原理是當紅外避障如果感應車靠近時，舵機把欄杆抬起。

## 二、了解紅外避障傳感器和舵機

### 2.1		紅外避障傳感器
紅外避障傳感器模塊具有一對紅外線發射管與接收管，發射管發射出一定頻率的紅外線。紅外線是波長介於微波與可見光之間的電磁波，其波長在 760 納米（nm）到 1mm 之間，比紅光長的非可見光。當檢測方向遇到物體或障礙物（反射面）時，紅外線反射回來被接收管接收， 經過比較器電路處理之後，綠色指示燈會亮起，同時信號輸出接口輸出數字信號（一個低電平信號），可通過電位器旋鈕調節檢測距離，有效距離範圍 2～30cm，工作 電壓為 3.3V-5V。
紅外避障傳感器使用的是紅外線，所以抗干擾能力 很強、干擾小，在距離適中的時候測量精度很高。除此外，該模塊便於裝配、使用方便，可以廣泛應用於機器人避障、避障小車、流水線計數及黑白線循跡等眾多場合。
該紅外避障傳感器有 4 個管腳，G 表示 GND 接地，V 代表接高電平、5V 或 3.3V,A 表示模擬輸入管腳，D 代表數字輸入管腳。但在編程使用時，A 和 D 接口只需使用一個即可，另外一個可忽略。

### 2.2		SG90舵機 
舵機是一種位置（角度）伺服的驅動器，其可以旋轉到 0 到 180 度之間的任何角度，然後根據你的指令精確停止，適用於那些需要角度不斷變化並可以保持的控制系統。目前普遍應用在高檔遙控玩具，如航模，包括飛機模型，潛艇模型；遙控機器人中。舵機是一個不專業的名稱，實際上它是一種伺服電機，一套自動控制裝置，由直流電機，減速齒輪組，傳感器和控制電路組成。什麽是自動控制？所謂的自動控制-通過使用閉環反饋控制電路不斷調整輸出偏差-使系統輸出恒定。
本節課使用的是 S90 舵機，其管腳有 3 個，G 表示 GND 接地，V 表示 VCC 接高電平，S 表示為信號管腳，其轉動的角度是通過調節 PWM（脈衝寬度調制）信號的占空比來實現的，所以需要 S 端管腳使用 BLE-UNO 主控板的 PWM 管腳控制（數字前帶“～”，如 3、5、6、9、10、11 號管腳）。
舵機的控制一般需要一個 20ms 左右的時基脈衝，該脈衝的高電平部分一般為 0.5ms～2.5ms 範圍內的角度控制衝部分。以 180 度角度伺服為例，其對應的控制關系如下：

0.5ms——0 度；
1.0ms——45 度；
1.5ms——90 度；
2.0ms——135 度；
2.5ms——180 度；

## 三、自動車庫門安裝

在安裝自動門之前，首先要對舵機進行調零，明確舵機轉動的角度，才能把其安裝在房子模型上，避免後面操作時會出現故障。把舵機接在 D3 管腳 上，然後，打開 Arduino IDE 然後輸入下面代碼：

#include <Servo.h> 
Servo servo;


void setup(){
servo.attach(3); //設置舵機信號引腳
}

void loop(){
servo.write(0); //設置舵機需要轉的角度
delay(2000);
servo.write(180); //設置舵機需要轉的角度
delay(2000);

}




上傳程序到 BLE-UNO 主板後，並使舵機舵臂擺動方向範圍如右圖所示從 0°到 180°來回擺動，當舵機擺到 0°時，關閉電源，然後按照以下步驟安裝在房子模型上:






用自攻螺絲把舵臂與欄杆連接固定，如圖 5-1 所示。











圖5-1

把舵機調零後，用M2 螺絲將其固定安裝在房子右側門旁邊下面，下圖所示：











圖5-2


把欄杆固定在舵機上，如圖 5-3 所示：











圖5-3

紅外避障傳感器安裝右邊，如圖 5-4 所示：











圖5-4

## 四、程序設計

### 4.1	算法設計

根據自動車庫門的原理，自動車庫門的算法設計如下：
第一步：設置舵機的引腳為 D3 和紅外避障傳感器的引腳為 D4；
第二步：判斷紅外避障傳感器是否感測到車，當紅外避障傳感器感應到車時，其返回值為 0，則舵機擺動 90°；否則，其返回值為 1，則舵機擺動 0°；
第三步，當舵機擺動90°打開欄杆時，過一段時間，自動擺會 0°，結束算法。

### 4.2	硬件連接：
舵機連接在擴展板的 D3 號管腳，紅外避障傳感器連接擴展板的 A0、D7（P5）管腳，並使用 D7 管腳讀取數據。
傳感器和執行器
主控板
紅外避障傳感器
A0、D7（P5），使用 D7 讀取數據
舵機
D3



### 4．3	程序示例：
Arduino IDE代碼
#include <Servo.h>
Servo servo;


void setup()
{
pinMode(7, INPUT);	//設置A3 為輸入模式
servo.attach(3); //設置舵機信號引腳
}

void loop()
{
if (digitalRead(7) == 0)
{	//判斷是否檢測到黑線
servo.write(90); //設置舵機需要轉的角度
delay(5000);
servo.write(0); //設置舵機需要轉的角度
}
else {
servo.write(0); //設置舵機需要轉的角度
}
}


Mixly程序

MagicBlock程序




## 五、總結
本節課我們通過自動車庫門的製作，了解紅外避障傳感器和舵機的原理，並掌握了如何編程獲取紅外避障傳感器檢測數據及控制舵機的擺動，實現了車庫門的自動檢測開啟和關閉。

