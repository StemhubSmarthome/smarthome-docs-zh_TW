# 第十一課	無線遙控系統



## 任務背景：

智能家居，顧名思義是家用電器設備等都是智能遙控的，比如電動窗簾、 遙控風扇、遙控電燈等都可以使用遙控控制，大大方便人們的生活。本節課的任務是製作一個無線控制系統，使用遙控器無線控制家電。


## 器材準備：

Arduino BLE-UNO主板、擴展板、電池盒、遙控器、遙控接收器、摩打風扇、紅綠燈模塊、舵機、連接線、USB 數據線。

## 一、了解無線遙控系統

本節課實現的無線遙控系統功能是是使用遙控器遙控風扇、LED 和窗戶等家用設備，其原理是利用遙控器發出紅外線信號，然後遙控接收器接收到相應的信號，從而控制家電的開關。


## 二、了解紅外遙控器和紅外接收器

紅外接收管是直接將電能轉化為近紅外光的器件，屬於二極管類。它的結構和原理與一般的發光二極管相似，只是半導體材料有所不同。紅外接收頭是一種接收、放大、解調裝置，內部集成電路已完成解調，輸出是數字信號。紅外接收頭由 IC 和 PD 兩部分組成。IC 是接收頭的處理元件，主要由矽晶體和電路組成。它是一個高度集成的設備。PD 是一種光電二極管，主要功能是接收光信號。紅外接收需先進行解調，解調的過程是通過紅外接收管進行接收的。其基本工作過程為：當紅外接收模塊接收到調制信號時，輸出高電平，否則輸出為低電平，是調制的逆過程。紅外接收頭輸出的原始數據信號，正好和發射端倒向。也就是以前發射端原始信號是高電平，那接收頭輸出的就是低電平，反之。
紅外遙控器發出的信號是一連串的二進制脈衝 碼。為了使其在無線傳輸過程中免受其他紅外信號的干擾，通常都是先將其調制在特定的載波頻率—38kHZ 上然後再經紅外發射二極管發射出去，紅外傳感器集成接收和調制紅外線。而紅外線接收裝置則要濾除其他雜波，另接收該特定頻率的信號並將其還原成二進制脈衝碼，也就是解調。
紅外接收模塊有三個引腳，G 為 GND 接地，V 為 VCC 接高電平 5v，S 為信號管腳，可接 D1-D13 數字接口。
EM 紅外遙控器鍵值對應表
EM 遙控器鍵值對應表
按鍵
十進制值
十六進制值
按鍵
十進制值
十六進制值
按鍵
十進制值
十六進制值
1
12
0x0C
8
82
0x52
A
69
0x45
2
24
0x18
9
74
0x4A
B
70
0x46
3
94
0x5E
0
22
0x16
C
71
0x47
4
8
0x08
UP
64
0x40
D
68
0x44
5
28
0x1C
DOWN
25
0x19
OK
21
0x15
6
90
0x5A
LEFT
7
0x07
+
67
0x43
7
66
0x42
RIGHT
9
0x09
-
13
0x0D


## 三、無線遙控安裝
用 M3*8 螺絲把紅外接收器安裝在房樑上，如圖 11-1 所示。













圖 11-1

## 四、程序設計

### 4.1	算法設計： 
第一步：設置控制燈或者風扇等設備的控制信號
第二步：判斷紅外接收器接收到遙控器發出的信號是否控制風扇或者燈的信號，如果是，則打開，否則，關閉；
第三步：結束算法。

### 4.2	硬件連接：
紅外接收器連接在擴展板的 D4（P10）號管腳；窗戶舵機連接在擴展板的 D3 號管腳；直流電機風扇模塊連接在擴展板的 D5、D6（P8）號管腳
傳感器和執行器
主控板
紅外接收器模塊
D4（P10）
舵機
D3
直流電機風扇模塊
D5、D6（P8）




### 4.3	示例程序：
Arduino IDE 程序

#include "IR_remote.h"
#include "keymap.h" IRremote ir(4);
void SetServoDegree(int Angle){
  for (int i = 0; i < 80; i++) {
    float pulsewidth = (Angle * 11) + 350;

    digitalWrite(3, HIGH);
  delayMicroseconds(pulsewidth);
  digitalWrite(3, LOW);
    delayMicroseconds(20000 - pulsewidth);

}
}
void setup(){ 
    ir.begin(); 
pinMode(3,OUTPUT);
pinMode(5,OUTPUT);
pinMode(6, OUTPUT);

}

void loop(){

if (ir.getIrKey(ir.getCode(),2) == EM_IR_KEYCODE_1) {
SetServoDegree(90);

}
if (ir.getIrKey(ir.getCode(),2) == EM_IR_KEYCODE_2) {
SetServoDegree(180);

}
if (ir.getIrKey(ir.getCode(),2) == EM_IR_KEYCODE_3) {
digitalWrite(5,HIGH);
digitalWrite(6,LOW);

}
if (ir.getIrKey(ir.getCode(),2) == EM_IR_KEYCODE_4) {

digitalWrite(5,LOW);
digitalWrite(6,LOW);

}

}


Mixly 程序


MigicBlock程序





## 五、總結
本節課我們學習了智能家居無線遙控系統的原理，利用紅外遙控器和接受器實現對風扇，窗戶等家居設備的控制，從中掌握了紅外遙控器和紅外接收器的編程及其原理
