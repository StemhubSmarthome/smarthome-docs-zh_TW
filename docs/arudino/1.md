# 第一課  認識智能家居

## 一、什麼是智能家居
<P>
智能家居（smart home, home automation）是以住宅為平台，再利用綜合布線技術、網路通信技術、安全防範技術、自動控制技術及音視頻技術將家居生活有關的設備集成一體，然後構建高效的住宅設施與家庭日程事務的管理系統，從而提升家居安全性、便利性、舒適性和藝術性，並實現環保節能的居住條件。
<P>

## 二、智能家居的優勢
<P>
1、智能化：由原來的被動靜止結構轉變為具有能動智能的工具。<BR>
2、信息化：提供全方位的訊息交換功能，幫助家庭與外部保持訊息交流暢通。<BR>
3、人性化：強調人的主觀能動性，重視人與居住環境的協調，使用戶能隨心所欲地控制室內居住環境。<BR>
4、節能化：關閉家用電器的睡眠模式，一鍵徹底斷電，從而節省了電能。 <BR>
<P>
<P>
本課程製作的智能家居是運用Arduino 開源硬體、傳感器模塊、編程和激光切割等技術實現的作品。旨在使讀者通過動手搭建房子模型，了解傳感器的特點和原理，學習Arduino 編程，運用傳感器來實現家居設備的智能自動化。從中不僅更加深入瞭解智能家居的特點及場景應用，且融會貫通地運用各種傳感器將生活家居設備等實現智能化，讓人們生活更加安全和便捷。
<P>

## 三、智能家居模型搭建步驟展示
<P>
1、前側和左側面組合在一起，如圖 1-1 所示：
<P>	


                                                                                                                              
圖1-1
<P>
2、組裝右側面，如圖 1-2 所示：
<P>

圖 1-2
<P>
3、拼裝後面，如圖 1-3 所示：
<P>
圖1-3
<P>
4、把組合好的房子四面插在底板上，如圖 1-4 所示：
<P>
圖1-4
<P>
5、拼裝房樑，如圖 1-5 所示：
<P>
圖 1-5
<P>
6、最後把屋頂的木板合上，房子的模型即完成拼裝，如圖 1-6 所示。
<P>
圖 1-6
<P>
註：傳感器等硬體的組裝，在課程後面的章節中展現。
<P>
	
## 四、了解 Arduino BLE-UNO 主板
<P>
Arduino BLE-Uno控制板是基於藍牙 4.0協議完美結合 Arduino Uno R3 由 Emakefun針對創客研發的一款革命性產品，功能和引腳完全兼容傳統 Arduino Uno主板，工作頻段為2.4GHZ範圍，調制方式為GFSK，最大發射功率為0db，最大發射距離 50 米，採用進口原裝 TI CC2540  芯片設計，支持用戶通過AT 命令修改查看設備名、服務UUID、發射功率、配對密碼等指令，方便快捷使用靈活。 產品身材卻非常小，適合於很多對於體積有苛刻限制的應用。我們提供 Android 和 IOS 手機 demo，你可以快速開發出一款與手機通信的硬體設備。 正如現在非常火爆的可穿戴式手機周邊設備，都可以用BLE-Uno 這款平台開發，你可以使用 BLE-Uno 與藍牙 4.0 設備連接，在兩個藍牙設備之間實現無線傳輸，主從機設置。甚至與 PC 建立藍牙 HID 連接。同時我們為開發者提供了極大的自由度和支持準備，用戶不僅可以通過 AT 指令配置  BLE-Uno，你還可以在 BLE-Uno 控制器上添加 Arduino 兼容的擴展板、傳感器、電機和舵機驅動等， emakefun 獨家研發藍牙主機模式自動連接從機功能，並支持超過 20 個位元組發送，使用更加方便。
<P>
<P>
➢	技術規格：
與 Arduino Uno R3 引腳和使用方法完全兼容
BLE 芯片:TI CC2540
工作頻道 2.4G
傳輸距離：空曠距離50m
支持 AT 指令配置 BLE
支持 USB 虛擬串口，硬體串口，BLE 三向透傳
支持主從機切換
主機模式下支持藍牙自動連接從機
支持超過 20byte 發送。
接口:Micro-USB
輸入電壓：USB 供電,Vin6~12V
微處理器：ATmega328PU
Bootloader：最新 Arduino1.8.8
引腳：兩排 2.54mm-15Pin
尺寸： 68.6mm x 53.4mm x 12mm
重量： 25g
<P>
<P>
➢	參數說明：
ON：電源指示燈。當 Arduino BLE-UNO 通電時，ON 燈會點亮。
Link 標識的藍燈為藍牙和電源指示燈，供電後藍燈閃爍，當藍牙未連接時 藍色燈光閃爍，連接後藍色燈常亮
L 標識的橙色燈為 BootLoader 識別指示燈，當通過 USB 連接電腦後，端口識別到板子的時候該 LED 燈會快速閃爍。該 LED 通過特殊電路連接到 Arduino 的 13 號引腳，當 13 號引腳為高電平或高阻態時，該 LED 會點亮；低電平時，不會點亮。可以通過程式或者外部輸入信號，控制該 LED 亮滅。
( 註：當 USB 數據線連接成功時 Link 藍色 LED 燈閃爍，並且 L 標識的橙色燈會閃爍數次，如果連上 USB 後只有 Link 藍色 LED 燈閃爍，但是 L 標識的橙色燈沒有反應，代表這根 USB-Micro 線是壞的請更換。)
RX 標識的 LED 燈為串口接收指示燈，當串口接收到數據，LED 燈會閃爍。
TX 標識的 LED 燈為串口發送指示燈，當串口發送數據時，LED 燈會閃爍。
Serial：0（RX）、1（TX），被用於接收和發送串口數據。這兩個引腳通 過連接到 ATmega16u2 芯片來與計算機進行串口通信。
外部中斷：2、3，可以輸入外部中斷信號。中斷有四種觸發模式：低電平觸發、電平改變觸發、上升沿觸發、下降沿觸發。
PWM 輸出：3、5、6、9、10、11，（板上標有絲印〜）可用於輸出 8-bit PWM 波。對應函數analogWrite() 。
SPI：10（SS）、11（MOSI）、12（MISO）、13（SCK），可用於 SPI 通 信。可以使用官方提供的 SPI 庫操縱。
L-LED：13 號引腳連接了一個 LED，當引腳輸出高電平時打開 LED，當引腳輸出低電平時關閉 LED。
TWI：A4（SDA）、A5（SCL）和 TWI 接口，可用於 TWI 通信，兼容I²C 通信。可以使用官方提供 的 Wire 庫操縱。Arduino Uno 6 個模擬輸入引 腳，可使用 analogRead() 讀取模擬值。每個模擬輸入都有 10 位解析度（即 1024 個不同的值）。默認情況下，模擬輸入電壓範圍為 0～5V，可使用 AREF 引 analog_Reference() 函數設置其他參考電壓。
AREF: 模擬輸入參考電壓輸入引腳。
Reset：復位端口。接低電平會使 Arduino 復位，復位按鍵按下時，會使該端口接到低電平，從而讓 Arduino 復位
Vin: 電源輸入引腳。當使用外部電源通過 DC 電源座供電時，這個引腳可以輸出電源電壓。
5V: 5V 電源引腳。使用 USB 供電時，直接輸出 USB 提供的 5V 電壓；使用外部電源供電時，輸出穩壓後的 5V 電壓。
3V3:3.3V 電源引腳。最大輸出能力為 50mA。
GND: 接地引腳
IOREF:I/O 參考電壓。其他設備可通過該引腳識別開發板 I/O 參考電壓。
<P>

## 五、了解Arduino IDE 及其安裝
<P>
Arduino IDE  是 Arduino 產品的軟件編輯環境。簡單來說就是用來寫代碼，下載代碼的地方。任何的 Arduino 產品都需要下載代碼後才能運作。
<P>
	
### 5.1  Arduino IDE 下載安裝
 用瀏覽器打開 Arduino 官網鏈接https://www.arduino.cc/en/Main/Donate ，
我們可以看到如圖 1-7 界面，在該界面中，我們可以看到 IDE 的不同版本和不同運行環境，大家根據自己的電腦系統進行下載即可。



圖 1-7 Arduino IDE 下載界面
<P>
下載結束後，我們會得到如圖 1-8 的壓縮包，將壓縮包進行解壓後如圖 1-9 中的文件，其中“drivers”是驅動軟件，在安裝“arduino.exe”時會自動安裝驅動。因為“arduino.exe”的安裝很簡單，這裡不再講解，建議在安裝過程中退出殺毒軟件，否則可能會影響 IDE 的安裝。安裝結束後，再次點擊 “arduino.exe”即可進入 IDE 程序編寫界面。
<P>
  圖 1-8	Arduino IDE 安裝包


圖 1-9	解壓後的文件
<P>
IDE 安裝結束後，我們接上 Arduino 主板，右鍵點擊“我的電腦”→“屬性”→“設備管理器”→查看“端口（COM 和 LTP）”，如果看到如圖 1-10 所示，
<P>
圖 1-10 驅動安裝成功界面
<P>
則說明驅動已安裝成功，這時我們打開 IDE，在工具欄中選擇對應的開發板型號和端口就正常使用了。如果出現如圖 1-11，則說明電腦沒有識別到開發板，需要自己安裝驅動程序。
<P>

圖 1-11	驅動未成功安裝界面


### 5.2	驅動安裝
<P>
5.2.1 Windows 系統驅動安裝步驟：
1）右鍵點擊“我的電腦”→打開設備管理器→查看端口（COM 和 LPT）。 此時你會看到一個“USB 串行端口”，右鍵單擊“USB 串行端口”並選擇“更新驅動程序軟件”選項。
<P>

圖 1-12 更新驅動界面
<P>
2）接下來，選擇“瀏覽計算機以查找驅動程序軟件”選項。
<P>
圖 1-13 驅動更新選擇界面
<P>
3）最後選擇名為“drivers”的驅動程序文件，位於 Arduino 軟件下載的 “Drivers”文件夾。
<P>

圖 1-14 驅動選擇


圖 1-15 驅動程序文件選擇界面
<P>
4）成功安裝之後便會出現下圖所示的界面，通知你驅動成功。
<P>

圖 1-16 驅動安裝成功界面
<P>
此時，我們再返回“設備管理器”界面，可以看到電腦已成功識別到 Arduino，如下圖 1-17 所示。接下來打開 Arduino 編譯環境，就可開啟 Arduino 之旅了。
<P>

圖 1-17 驅動成功識別界面
<P>
注意：在 Win10 系統中，部分 Arduino 在接入電腦後（非正版芯片很難被識別），系統會自動下載相對應的驅動，無需自己安裝驅動，但是在 Win7 系統中，就需要按照上述的步驟手動安裝驅動。
如上圖所示我們可以看到 USB 串口被識別為 COM15，但不同的電腦可能不一樣，你的可能是 COM4、COM5 等，但是 Arduino Uno 這個一定是一樣的。如 果沒找到 USB 串口，則有可能是你安裝有誤，或者系統不兼容。
<P>
### 5.3 Arduino IDE 界面介紹
<P>
打開 Arduino 的 IDE 界面之後可以看到如圖 1-18 所示的界面，工具欄按鈕功能依次為“編譯”--“上傳”--“新建”--“打開”--“保存”--“串口監視器”。
<P>

圖 1-18 Arduino IDE 界面介紹
<P>
菜單欄上有 5 個菜單，不過我們主要介紹文件和工具。點擊文件，彈出如圖 1-18 界面，可以看到示例和首選項，其中示例是一些 Arduino IDE 自帶的程序，這些都是編譯無誤、可正常使用的程序，對初學者有很大的幫助。而首選項中，主要是參數的設置，如語言，字體等。
<P>

## 六、了解 Mixly 及其安裝
<P>
Mixly 是北京師範大學教育學部創客教育實驗室負責人傅騫老師及其團隊開發的，是一款面向 Arduino 創意電子的圖形化編程工具，完全免費。它完美地支持了 Arduino、MicroPython，Python 等語言的編程。提供了圖形化界面和代碼界面對比顯示的支持。Mixly 還支持自定義第三方擴展庫，可以拓展出豐富的功能。
<P>
	
### 6.1	Mixly 安装
<P>
1）致 Mixly官網下載（如圖 1-19 所示），下載地址：
http://mixly.org/explore/software/mixly-arduino
<P>


圖 1-19
<P>
2） Windows 版下載解壓後直接雙擊 Mixly.exe 即可打開 Mixly 軟件，如 圖 1-20 所示。
<P>


圖 1-20
<P>
3）Windows 系統版的Mixly 軟件打開後界面，如圖 1-21 所示。
<P>
圖 1-21

### 6.2	Mixly 的軟件界面介紹
圖 1-22
<P>
基礎模塊區和庫模塊區：同種類型的積木被分在同個模塊中並賦予同種顏色，每塊積木代表一條控制指令。
功能區：對項目文件的創建、保存，庫的導入、導出、管理，串口連接與上傳程序，控制板選擇進行操作的區域。
程序構建區：是放置從基礎模塊區和庫模塊區拖拽出來的積木塊的地方。
代碼區：拖拽出積木後，點擊“代碼”，可以看到你拖拽的模塊對應 的 C 語言代碼。
語言切換區：可以切換中文簡體，中文繁體，英文和西班牙文。
縮放控制區：可以將軟件操作界面進行縮放。
垃圾箱：用來移除不需要的積木塊。
<P>
	
### 6.3	Mixly 導入庫
<P>
使用 Mixly 編程時，Mixly 原有的程序積木塊可能不支持我們的傳感器，或者沒有符合傳感器的使用積木塊，因此我們需要導入我們自主研發的傳感器庫文件，以便讓讀者更好地使用。
打開 Mixly 軟件進入其頁面，接著點擊“導入庫”，進入電腦的本地文件，找到 sensor 文件中的 sensor.xml 文件，點擊打開，即可導入庫文件。
<P>


圖 1-23




圖 1-24


## 七、了解 MagicBlock（Scratch3.0）及其安裝
<P>
MagicBlock 是深圳市易創空間科技有限公司基於 Scratch3.0 開發，面向 STEM 教育的一款圖形化編程教學軟件，它在 Scratch3.0 的基礎上添加了的眾多常用傳感器和 Arduino 主板的圖形化編程塊，同時支持舞台模式和上傳模式，可以通過圖形塊的搭建為電子硬件編寫程序，展現創意，是一款可以讓青少年學習編程，快速入門編程的軟件。
<P>

### 7.1	安装 MagicBlock
<P>
1）瀏覽器輸入 www.emakefun.com/download 進入深圳市易創空間科技有限公司官網的軟件下載頁面，根據自己電腦的系統選擇相應系統版本的 MagicBlock，單擊即可下載。
<P>

圖1-25
<P>
2）下載後雙擊圖標進行安裝
<P>
圖1-26
<P>
3）點擊“下一步”
<P>
圖1-27
<P>
4）選擇需要安裝的目錄，默認為 C 盤，繼續點擊“下一步”。
<P>
圖1-28

### 7.2	安裝驅動
<P>
雙擊軟件圖標打開軟件界面，點擊 MagicBlock 軟件右上角的設置按鈕，選擇 Windows：CH340 驅動，點擊安裝。
<P>

圖 1-29


## 八、編寫 Welcome to smart home 程序
<P>
1）將 Arduino UNO 和電腦通過 USB 連接；
2）打開你要使用的編程軟件，輸入下列對應的示例程序，如圖 1-30 所示
3）上傳程序後，打開串口監視器，即可看到屏幕上不斷打印“Welcome to smart home”，如圖 1-31 所示。
<P>

Arduino IDE
void setup(){
Serial.begin(9600);
}


void loop(){
Serial.println("Welcome to smart home");

delay(500);


}
Mixly 軟件
MagicBlock



圖 1-30	示例程序




圖 1-31	串口打印
