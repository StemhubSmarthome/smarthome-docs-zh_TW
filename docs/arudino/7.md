# 第七課	光控自動窗戶



## 任務背景

智能家居窗戶作為一種可實現智能操控的窗戶，比起傳統的窗戶來說操控更加的方便，也更加的安全。這節課我們就來製作一個光控的自動窗戶，它具有自動感應光照強度的功能，從而根據光線的變化自動調節窗戶開合。


## 器材準備

Arduino主板、擴展板、電池盒、S90 舵機、雨滴傳感器模塊、連接線、數據線。

## 一、了解光控自動窗戶的原理

本課程製作的光控自動窗戶是利用光敏傳感器、數碼管顯示器和舵機實現的，其原理是利用數碼管顯示光敏傳感器感受外界的光照強度變化，並判斷光照強度是否適合開窗，如果光照強度合適時，那麽控制舵機把窗戶打開；反之，如果關照強度不適合開窗，那麽關閉窗戶。


## 二、了解光敏傳感器和數碼管顯示器

### 2.1		光敏傳感器
光敏電阻是用硫化鎘或硒化鎘等半導體材料制成的特殊電阻器，其工作原理是基於內光電效應。光照愈強，阻值就愈低，隨著光照強度的升高，電阻值迅速降低，亮電阻值可小至 1KΩ 以下。光敏電阻對光線十分敏感，其在無光照時，呈高阻狀態，暗電阻一般可達 1.5MΩ。光敏電阻的特殊性能，隨著科技的發展將得到極其廣泛應用。光敏傳感器它也可廣泛應用於各種光控電路，比如控制和調節燈光。光敏電阻對環境光線最敏感，一般用來檢測周圍環境的光線亮度等 。
本課程使用的光敏傳感器有 G、V、S 三個引腳。G 為 GND 接地，V 為 VCC 接高電平，S 為數據傳送管腳，可接 A0-A5 模擬引腳。



### 2.2		數碼管顯示器
數碼管，也稱作輝光管，是一種可以顯示數字和其他信息的電子設備。
本課程使用的 4 位 7 段數碼管是由一個 12 管腳的 4 位 7 段共陽極數碼管和一個控制芯片 TM1650 構成。此產品可以應用在顯示數字的設備上。4 位 7 段共陰數碼管是每一位的 8 個 LED 的陰極連接在一起如圖 7-1，此模塊是通過 TM1650 芯片驅動 4 位七段數碼管，採用的是兩線串行通信。DP 為小數點，TM1650 的詳細參數請看芯片數據手冊。

圖 7-1

4 位 7 段數碼管有 G、V、DIO 和 CLK 管腳，G 表示 GND，要接地，V 代表 VCC，可接主板的 5.5V 和 3.3V， DIO 表示數據線，用來數據傳輸的線路，CLK 表示時鐘線，用來提供時鐘信號的線路。其可以接 Arduino 主板的 IIC（A4、A5）接口。

## 三、光控自動窗戶安裝
課程中的窗戶是利用 S90 舵機作為門開關的動力機構，因此在安裝舵機前，要先對舵機進行調零，明確舵機的擺動角度範圍，再安裝到房子上，其安裝步驟如下：

1）調零舵機，確定舵臂的擺動方向
2）用自攻螺絲把窗橫杆和舵臂組裝固定，如圖 7-2 所示。


                         圖 7-2

3）用 M2 螺絲把舵機和舵機支架組裝連接，如圖 7-3 所示。

                         圖 7-3

4）然後把門杆安裝在舵機上，如圖 7-4 所示。







圖 7-4

5）把螺母裝在窗體上，然後把窗橫杆安裝在舵機上，如圖 7-5 所示。







圖 7-5

5）把螺母裝在窗體上，然後把窗橫杆安裝在舵機上，如圖 7-6 所示。








圖 7-6

5）接著把光敏傳感器安裝在屋頂木板上，如圖 7-7 所示。










                         圖 7-7

6）最後用 M2*8 的螺絲把數碼管顯示器固定安裝前面，如圖 7-8 所示。











圖 7-8


## 四、程序設計
### 4.1		算法設計
根據光控自動窗戶的原理，其算法設計如下： 

第一步：設定光照強度的閾值
第二步：數碼管顯示光照強度數值，並比較周圍光照強度與光照強度閾值。如果大於光照強度閾值，窗戶打開；如果小於光照強度閾值，窗戶關閉
第三步：結束算法




### 4.2	硬件連接
光敏傳感器接在 Arduino 擴展板上的 A0（P4）管腳，數碼管顯示器模塊接在 Arduino 擴展板上的 A4、A5（P7）管腳，舵機接在 Arduino 擴展板上的 D3 管腳。

傳感器和執行器
主控板
光敏傳感器
A0（P4）
數碼管顯示器
  A4、A5（P7）
舵機
D3







### 4.3	示例程序
Arduino IDE 程序

#include <Wire.h>
#include <TM1650.h>
#include <Servo.h> 
TM1650 tm_4display; volatile int _light; Servo servo_3;
void setup(){
Wire.begin();
tm_4display.init();

_light = 0;
servo_3.attach(3);
}
void loop(){
tm_4display.clear();

_light = analogRead(A0); tm_4display.displayString(_light); delay(500);
if (_light > 100) { servo_3.write(90); delay(20);
} else {
servo_3.write(0);
delay(20);
}

















Mixly 程序

MagicBlock 程序




## 五、總結
本節課我們學習了光敏傳感器和數碼管的特點及其使用，並了解光控窗戶的原理，通過製作光控自動窗戶，掌握了光敏傳感器數碼管的編程，實現了當光照強時，打開窗戶；反之，關閉窗戶的功能。

